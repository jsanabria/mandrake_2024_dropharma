ew.events={entradas_salidas:{x_articulo:{change:function(e){var $row=$(this).fields();var xi=0;var xy=0;var tipo_documento=$("#x_tipo_documento").value();if(tipo_documento!="TDCAEN"){$.each($(this).fields(),(function(i,field){xi++}));if(xi<=3){return false}var tipo="SALIDAS";try{xy=$row["precio_unidad"].value()}catch(err){tipo="ENTRADAS"}var articulo=$row["articulo"].toNumber();if(tipo=="ENTRADAS"){$.ajax({url:"include/Articulo_Buscar_Costo.php",type:"GET",data:{articulo:articulo},beforeSend:function(){}}).done((function(MyResult){var desc1=isNaN($row["descuento"].toNumber())||$row["descuento"].toNumber()==""?0:parseFloat($row["descuento"].toNumber());var descuento=isNaN($("#x_descuento").val())||$("#x_descuento").val().trim()==""?0:parseFloat($("#x_descuento").val());$row["precio_unidad_sin_desc"].value(MyResult);$row["descuento"].value(descuento);st=$row["precio_unidad_sin_desc"].toNumber()-$row["precio_unidad_sin_desc"].toNumber()*descuento/100;$row["costo_unidad"].value(st);st=$row["cantidad_articulo"].toNumber()*st;$row["costo"].value(st)})).fail((function(data){alert("error"+data)})).always((function(data){}));try{for(i=1;i<=200;i++){$("#x"+i+"_precio_unidad_sin_desc").prop("readonly",false);$("#x"+i+"_costo_unidad").prop("readonly",true);$("#x"+i+"_costo").prop("readonly",true)}}catch(err){}}if(tipo=="SALIDAS"){cliente=$("#x_cliente").val();$.ajax({url:"include/Articulo_Buscar_Precio_Tarifa_Defecto.php",type:"GET",data:{articulo:articulo,cliente:cliente},beforeSend:function(){}}).done((function(MyResult){try{if(isNaN(parseFloat(MyResult)))$row["precio_unidad"].value(0);else $row["precio_unidad"].value(parseFloat(MyResult));$row["cantidad_articulo"].value("");$row["precio"].value("")}catch(err){}})).fail((function(data){alert("error"+data)})).always((function(data){}))}}}},x_cantidad_articulo:{"change keyup":function(e){var $row=$(this).fields();var tipo="SALIDAS";try{$row["precio_unidad"].toNumber()}catch(err){tipo="ENTRADAS"}var st=0;var articulo=0;var cantidad=0;var cliente=0;var proveedor=0;if(tipo=="SALIDAS"){st=$row["cantidad_articulo"].toNumber()*$row["precio_unidad"].toNumber();$row["precio"].value(st);articulo=$row["articulo"].toNumber();cantidad=$row["cantidad_articulo"].toNumber();cliente=$("#x_cliente").val();$.ajax({url:"include/Articulo_Buscar_Cantidad.php",type:"GET",data:{articulo:articulo,cantidad:cantidad,cliente:cliente},beforeSend:function(){}}).done((function(MyResult){myDat=MyResult.split("|");if(myDat[0]=="S"){if($("#x_tipo_documento").val()=="TDCFCV")st=cantidad*parseFloat(myDat[1]);else{alert("Cantidad del articulo mayor a la disponible; !!! Verifique !!!.");$row["cantidad_articulo"].value(0,0);$row["precio"].value(0)}}else{st=cantidad*parseFloat(myDat[1])}})).fail((function(data){alert("error"+data)})).always((function(data){}));var i=0;var total=0;for(i=0;i<101;i++){if($("#x"+i+"_precio").length){if($("#x"+i+"_precio").val().trim()!="")total+=parseFloat($("#x"+i+"_precio").val())}}$("#xSubTotal").html('<h3 class="text-success" id="xSubTotal"><strong>SubTotal: $ '+total.toFixed(2)+"</strong></h3>")}else if(tipo=="ENTRADAS"){st=$row["cantidad_articulo"].toNumber()*$row["costo_unidad"].toNumber();$row["costo"].value(st);var i=0;var total=0;for(i=0;i<101;i++){if($("#x"+i+"_costo").length){if($("#x"+i+"_costo").val().trim()!="")total+=parseFloat($("#x"+i+"_costo").val())}}$("#xSubTotal").html('<h3 class="text-success" id="xSubTotal"><strong>SubTotal: $ '+total.toFixed(2)+"</strong></h3>")}}},x_precio_unidad_sin_desc:{change:function(e){var $row=$(this).fields();var tipo="SALIDAS";try{$row["precio_unidad"].toNumber()}catch(err){tipo="ENTRADAS"}var descuento=isNaN($("#x_descuento").val())||$("#x_descuento").val().trim()==""?0:parseFloat($("#x_descuento").val());var desc1=0;var st=0;if(tipo=="ENTRADAS"){desc1=isNaN($row["descuento"].toNumber())||$row["descuento"].toNumber()==""?0:parseFloat($row["descuento"].toNumber());descuento=desc1==0?descuento:desc1;st=$row["precio_unidad_sin_desc"].toNumber()-$row["precio_unidad_sin_desc"].toNumber()*descuento/100;$row["costo_unidad"].value(st);st=$row["cantidad_articulo"].toNumber()*st;$row["costo"].value(st);$row["descuento"].value(descuento);var i=0;var total=0;for(i=0;i<101;i++){if($("#x"+i+"_costo").length){if($("#x"+i+"_costo").val().trim()!="")total+=parseFloat($("#x"+i+"_costo").val())}}$("#xSubTotal").html('<h3 class="text-success" id="xSubTotal"><strong>SubTotal: $ '+total.toFixed(2)+"</strong></h3>")}}},x_descuento:{change:function(e){var $row=$(this).fields();var tipo="SALIDAS";try{$row["precio_unidad"].toNumber()}catch(err){tipo="ENTRADAS"}var descuento=isNaN($("#x_descuento").val())||$("#x_descuento").val().trim()==""?0:parseFloat($("#x_descuento").val());var desc1=0;var st=0;if(tipo=="ENTRADAS"){desc1=isNaN($row["descuento"].toNumber())||$row["descuento"].toNumber()==""?0:parseFloat($row["descuento"].toNumber());descuento=desc1==0?descuento:desc1;st=$row["precio_unidad_sin_desc"].toNumber()-$row["precio_unidad_sin_desc"].toNumber()*descuento/100;$row["costo_unidad"].value(st);st=$row["cantidad_articulo"].toNumber()*st;$row["costo"].value(st);$row["descuento"].value(descuento);var i=0;var total=0;for(i=0;i<101;i++){if($("#x"+i+"_costo").length){if($("#x"+i+"_costo").val().trim()!="")total+=parseFloat($("#x"+i+"_costo").val())}}$("#xSubTotal").html('<h3 class="text-success" id="xSubTotal"><strong>SubTotal: $ '+total.toFixed(2)+"</strong></h3>")}}},x_costo_unidad:{change:function(e){var $row=$(this).fields();var tipo="SALIDAS";try{$row["precio_unidad"].toNumber()}catch(err){tipo="ENTRADAS"}var descuento=isNaN($("#x_descuento").val())||$("#x_descuento").val().trim()==""?0:parseFloat($("#x_descuento").val());var desc1=0;var st=0;if(tipo=="ENTRADAS"){desc1=isNaN($row["descuento"].toNumber())||$row["descuento"].toNumber()==""?0:parseFloat($row["descuento"].toNumber());descuento=desc1==0?descuento:desc1;st=$row["precio_unidad_sin_desc"].toNumber()-$row["precio_unidad_sin_desc"].toNumber()*descuento/100;$row["costo_unidad"].value(st);st=$row["cantidad_articulo"].toNumber()*st;$row["costo"].value(st);$row["descuento"].value(descuento);var i=0;var total=0;for(i=0;i<101;i++){if($("#x"+i+"_costo").length){if($("#x"+i+"_costo").val().trim()!="")total+=parseFloat($("#x"+i+"_costo").val())}}$("#xSubTotal").html('<h3 class="text-success" id="xSubTotal"><strong>SubTotal: $ '+total.toFixed(2)+"</strong></h3>")}}},x_precio_unidad:{change:function(e){var $row=$(this).fields();$("#txtCtrl2").val("");var tipo="SALIDAS";try{$row["precio_unidad"].toNumber()}catch(err){tipo="ENTRADAS"}if(tipo=="SALIDAS"){var st=$row["cantidad_articulo"].toNumber()*$row["precio_unidad"].toNumber();$row["precio"].value(st);var i=0;var total=0;for(i=0;i<101;i++){if($("#x"+i+"_precio").length){if($("#x"+i+"_precio").val().trim()!="")total+=parseFloat($("#x"+i+"_precio").val())}}$("#xSubTotal").html('<h3 class="text-success" id="xSubTotal"><strong>SubTotal: $ '+total.toFixed(2)+"</strong></h3>")}}}},purga_detalle:{x_fabricante:{"change onchange":function(e){var $row=$(this).fields();$row["articulo"].value("");$row["cantidad_articulo"].value(0,0)}},x_lote:{change:function(e){var $row=$(this).fields();var articulo=$row["articulo"].toNumber();var lote=$row["lote"].val().trim();if(articulo>0){if(lote!=""){}}}}}};ew.charts={};ew.clientScript=function(){window.CambiarCantidad=function(xId,xName,xValue){xValue=parseInt(xValue);$.ajax({url:"include/Validar_Cantidad_Packer.php",type:"GET",data:{id:xId,cantidad:xValue},beforeSend:function(){}}).done((function(data){var resp=data;if(resp=="S"){alert("Cantidad OK...")}else{alert("!!! Error: La cantidad es mayor a la solicitada o es menor a cero !!!");$("#"+xName+"").val("")}})).fail((function(data){alert("error"+data)})).always((function(data){}))}};ew.startupScript=function(){};
